<!DOCTYPE html>
<html lang='en'>
  <head>
    <title>Getting Started Guide  Reference</title>
    <link rel='stylesheet' type='text/css' href='css/jazzy.css' />
    <link rel='stylesheet' type='text/css' href='css/highlight.css' />
    <meta charset='utf-8'>
    <script src='js/jquery.min.js' defer></script>
    <script src='js/jazzy.js' defer></script>
  </head>
  <body>


    <a title='Getting Started Guide  Reference'></a>

    <header class='header'>
      <p class='header-col header-col--primary'>
        <a class='header-link' href='index.html'>
          ReSwift Docs
        </a>
         (69% documented)
      </p>
    
        <p class='header-col header-col--secondary'>
          <a class='header-link' href='https://github.com/ReSwift/ReSwift'>
            <img class='header-icon' src='img/gh.png'/>
            View on GitHub
          </a>
        </p>
    
        <p class='header-col header-col--secondary'>
          <a class='header-link' href='dash-feed://http%3A%2F%2FReSwift.github.io%2FReSwift%2Fmaster%2Fdocsets%2FReSwift.xml'>
            <img class='header-icon' src='img/dash.png'/>
            Install in Dash
          </a>
        </p>
    </header>

    <p class='breadcrumbs'>
      <a class='breadcrumb' href='index.html'>ReSwift Reference</a>
      <img class='carat' src='img/carat.png' />
      Getting Started Guide  Reference
    </p>

    <div class='content-wrapper'>
      <nav class='navigation'>
        <ul class='nav-groups'>
          <li class='nav-group-name'>
            <a class='nav-group-name-link' href='Documentation.html'>Documentation</a>
            <ul class='nav-group-tasks'>
              <li class='nav-group-task'>
                <a class='nav-group-task-link' href='about-reswift.html'>About ReSwift</a>
              </li>
              <li class='nav-group-task'>
                <a class='nav-group-task-link' href='why-reswift.html'>Why ReSwift</a>
              </li>
              <li class='nav-group-task'>
                <a class='nav-group-task-link' href='getting-started-guide.html'>Getting Started Guide</a>
              </li>
              <li class='nav-group-task'>
                <a class='nav-group-task-link' href='installation.html'>Installation</a>
              </li>
              <li class='nav-group-task'>
                <a class='nav-group-task-link' href='checking-out-source-code.html'>Checking out Source Code</a>
              </li>
              <li class='nav-group-task'>
                <a class='nav-group-task-link' href='demo.html'>Demo</a>
              </li>
              <li class='nav-group-task'>
                <a class='nav-group-task-link' href='extensions.html'>Extensions</a>
              </li>
              <li class='nav-group-task'>
                <a class='nav-group-task-link' href='example-projects.html'>Example Projects</a>
              </li>
              <li class='nav-group-task'>
                <a class='nav-group-task-link' href='contributing.html'>Contributing</a>
              </li>
              <li class='nav-group-task'>
                <a class='nav-group-task-link' href='credits.html'>Credits</a>
              </li>
              <li class='nav-group-task'>
                <a class='nav-group-task-link' href='get-in-touch.html'>Get in touch</a>
              </li>
              <li class='nav-group-task'>
                <a class='nav-group-task-link' href='changelog.html'>Changelog</a>
              </li>
              <li class='nav-group-task'>
                <a class='nav-group-task-link' href='license.html'>License</a>
              </li>
            </ul>
          </li>
          <li class='nav-group-name'>
            <a class='nav-group-name-link' href='Stores.html'>Stores</a>
            <ul class='nav-group-tasks'>
              <li class='nav-group-task'>
                <a class='nav-group-task-link' href='Classes/Store.html'>Store</a>
              </li>
              <li class='nav-group-task'>
                <a class='nav-group-task-link' href='Protocols/StoreType.html'>StoreType</a>
              </li>
              <li class='nav-group-task'>
                <a class='nav-group-task-link' href='Protocols/StoreSubscriber.html'>StoreSubscriber</a>
              </li>
              <li class='nav-group-task'>
                <a class='nav-group-task-link' href='Protocols/AnyStoreSubscriber.html'>AnyStoreSubscriber</a>
              </li>
            </ul>
          </li>
          <li class='nav-group-name'>
            <a class='nav-group-name-link' href='State.html'>State</a>
            <ul class='nav-group-tasks'>
              <li class='nav-group-task'>
                <a class='nav-group-task-link' href='State.html#/s:7ReSwift9StateTypeP'>StateType</a>
              </li>
            </ul>
          </li>
          <li class='nav-group-name'>
            <a class='nav-group-name-link' href='Actions.html'>Actions</a>
            <ul class='nav-group-tasks'>
              <li class='nav-group-task'>
                <a class='nav-group-task-link' href='Actions.html#/s:7ReSwift6ActionP'>Action</a>
              </li>
              <li class='nav-group-task'>
                <a class='nav-group-task-link' href='Actions.html#/s:7ReSwift0aB4InitV'>ReSwiftInit</a>
              </li>
            </ul>
          </li>
          <li class='nav-group-name'>
            <a class='nav-group-name-link' href='Reducers.html'>Reducers</a>
            <ul class='nav-group-tasks'>
              <li class='nav-group-task'>
                <a class='nav-group-task-link' href='Reducers.html#/s:7ReSwift7Reducera'>Reducer</a>
              </li>
            </ul>
          </li>
          <li class='nav-group-name'>
            <a class='nav-group-name-link' href='Utilities.html'>Utilities</a>
            <ul class='nav-group-tasks'>
              <li class='nav-group-task'>
                <a class='nav-group-task-link' href='Protocols/Coding.html'>Coding</a>
              </li>
            </ul>
          </li>
          <li class='nav-group-name'>
            <a class='nav-group-name-link' href='Other Classes.html'>Other Classes</a>
            <ul class='nav-group-tasks'>
              <li class='nav-group-task'>
                <a class='nav-group-task-link' href='Classes/Subscription.html'>Subscription</a>
              </li>
            </ul>
          </li>
          <li class='nav-group-name'>
            <a class='nav-group-name-link' href='Other Protocols.html'>Other Protocols</a>
            <ul class='nav-group-tasks'>
              <li class='nav-group-task'>
                <a class='nav-group-task-link' href='Protocols/DispatchingStoreType.html'>DispatchingStoreType</a>
              </li>
            </ul>
          </li>
          <li class='nav-group-name'>
            <a class='nav-group-name-link' href='Other Type Aliases.html'>Other Type Aliases</a>
            <ul class='nav-group-tasks'>
              <li class='nav-group-task'>
                <a class='nav-group-task-link' href='Other%20Typealiases.html#/s:7ReSwift16DispatchFunctiona'>DispatchFunction</a>
              </li>
              <li class='nav-group-task'>
                <a class='nav-group-task-link' href='Other%20Typealiases.html#/s:7ReSwift10Middlewarea'>Middleware</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class='main-content'>

        <section class='section'>
          <div class='section-content'>
            
            <h1 id='getting-started-with-reswift' class='heading'>Getting Started with ReSwift</h1>

<p>ReSwift provides the infrastructure for <code><a href="Classes/Store.html">Store</a></code>s, <code><a href="Actions.html#/s:7ReSwift6ActionP">Action</a></code>s and <code><a href="Reducers.html#/s:7ReSwift7Reducera">Reducer</a></code>s to enable a unidirectional data flow as shown below.</p>

<p><img src="img/reswift_detail.png" alt="Detailed flowchart of data flow with ReSwift"></p>

<p>The following section will briefly describe how to set up the core components of ReSwift in your app. The next section will describe the components that power ReSwift in depth.</p>

<p>To see ReSwift in action, <a href="https://github.com/ReSwift/">have a look at the repositories on GitHub</a>, which contains example apps and playgrounds.</p>
<h1 id='general-setup-and-high-level-overview' class='heading'>General Setup and High-Level Overview</h1>

<p>This section will show you how to set up the core ReSwift components in your app. It is intended to provide a quick start to get the ball rolling.</p>
<h2 id='high-level-overview' class='heading'>High-Level Overview</h2>

<p>To get the infrastructure up and running you need to set up a <code><a href="Classes/Store.html">Store</a></code> for a root app state type. The type requirement is <code>ReSwift.Store&lt;State&gt;</code>. You set it up like this:</p>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">ReSwift</span>

<span class="kd">struct</span> <span class="kt">AppState</span> <span class="p">{</span>
    <span class="c1">// ... app state properties here ...</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">appReducer</span><span class="p">(</span><span class="nv">action</span><span class="p">:</span> <span class="kt">Action</span><span class="p">,</span> <span class="nv">state</span><span class="p">:</span> <span class="kt">AppState</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">AppState</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">store</span> <span class="o">=</span> <span class="kt">Store</span><span class="p">(</span>
    <span class="nv">reducer</span><span class="p">:</span> <span class="n">appReducer</span><span class="p">,</span> 
    <span class="nv">state</span><span class="p">:</span> <span class="kt">AppState</span><span class="p">(),</span>   <span class="c1">// You may also start with `nil`</span>
    <span class="nv">middleware</span><span class="p">:</span> <span class="p">[])</span>      <span class="c1">// Middlewares are optional</span>
</code></pre>

<p>Keep the store around somewhere. For example in an <code>NSDocumentController</code>, the <code>AppDelegate</code>, or as a global variable.</p>

<p>The process of implementing then works like this:</p>

<ol>
<li>You can add <strong>subscribers</strong> to the store and <strong>dispatch actions</strong>.</li>
<li>The actions will be pre-processed by your <strong>middleware</strong>. The middleware can act on actions and pass them along, producing side effects or dispatching additional actions itself. It can also do some side effects like logging to the console and passing the action along.</li>
<li>Finally, if any action was passed through all middleware, it&rsquo;ll reach the root <strong>reducer</strong>, here called <code>appReducer</code> by convention. The reducer changes the <strong>state</strong> according to the incoming action.</li>
<li>The resulting state is then stored in the <strong>store</strong>. The store consequently propagates the new state to all <strong>subscriptions</strong>, reaching the <strong>subscriber</strong> objects if the subscription requirements are met. For example, one requirement may be to notify subscribers only when the state they are interested in has changed. This is the default <code><a href="Classes/Store.html">Store</a></code> setting. If you want to pass on identical states after a reducer pass, have a look at <code>automaticallySkipsRepeats</code> in the <code><a href="Classes/Store.html">Store</a></code>&lsquo;s initializer.</li>
</ol>

<p>For reference, the store&rsquo;s initializer and the initializer&rsquo;s type requirements all together look like this:</p>
<pre class="highlight swift"><code><span class="kd">class</span> <span class="kt">Store</span><span class="o">&lt;</span><span class="kt">State</span><span class="o">&gt;</span><span class="p">:</span> <span class="kt">StoreType</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">required</span> <span class="nf">init</span><span class="p">(</span>
        <span class="nv">reducer</span><span class="p">:</span> <span class="kd">@escaping</span> <span class="kt">Reducer</span><span class="o">&lt;</span><span class="kt">State</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="nv">state</span><span class="p">:</span> <span class="kt">State</span><span class="p">?,</span>
        <span class="nv">middleware</span><span class="p">:</span> <span class="p">[</span><span class="kt">Middleware</span><span class="o">&lt;</span><span class="kt">State</span><span class="o">&gt;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="p">)</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p><code><a href="Reducers.html#/s:7ReSwift7Reducera">Reducer&lt;State&gt;</a></code> is a mere function signature alias:</p>
<pre class="highlight swift"><code><span class="kd">typealias</span> <span class="kt">Reducer</span><span class="o">&lt;</span><span class="kt">ReducerStateType</span><span class="o">&gt;</span> <span class="o">=</span>
    <span class="p">(</span><span class="nv">action</span><span class="p">:</span> <span class="kt">Action</span><span class="p">,</span> <span class="nv">state</span><span class="p">:</span> <span class="kt">ReducerStateType</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">ReducerStateType</span>
</code></pre>

<p>To find out more about how to implement the concrete types and satisfy their requirements, read on. To get a look at the source of these few core types that make up ReSwift, <a href="https://github.com/ReSwift/ReSwift/tree/master/ReSwift/CoreTypes">check out the code on GitHub</a>.</p>
<h2 id='minimal-working-example' class='heading'>Minimal Working Example</h2>

<p>If you want to see how you can fill in the gaps we left above, take a look at the following example:</p>
<pre class="highlight swift"><code><span class="kd">import</span> <span class="kt">ReSwift</span>

<span class="kd">struct</span> <span class="kt">AppState</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="p">}</span>

<span class="c1">// This action does not have state and is a mere marker of "X happened":</span>
<span class="kd">struct</span> <span class="kt">AddAction</span><span class="p">:</span> <span class="kt">Action</span> <span class="p">{</span> <span class="p">}</span>

<span class="kd">func</span> <span class="nf">appReducer</span><span class="p">(</span><span class="nv">action</span><span class="p">:</span> <span class="kt">Action</span><span class="p">,</span> <span class="nv">state</span><span class="p">:</span> <span class="kt">AppState</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">AppState</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">state</span> <span class="o">=</span> <span class="n">state</span> <span class="p">??</span> <span class="kt">AppState</span><span class="p">()</span>

    <span class="k">switch</span> <span class="n">action</span> <span class="p">{</span>
    <span class="k">case</span> <span class="k">let</span> <span class="nv">addAction</span> <span class="k">as</span> <span class="kt">AddAction</span><span class="p">:</span> <span class="n">state</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">default</span><span class="p">:</span> <span class="k">break</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">state</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">store</span> <span class="o">=</span> <span class="kt">Store</span><span class="p">(</span>
    <span class="nv">reducer</span><span class="p">:</span> <span class="n">appReducer</span><span class="p">,</span> 
    <span class="nv">state</span><span class="p">:</span> <span class="kt">AppState</span><span class="p">(),</span>
    <span class="nv">middleware</span><span class="p">:</span> <span class="p">[])</span>
</code></pre>

<p>To make something happen, dispatch an action:</p>
<pre class="highlight swift"><code><span class="n">store</span><span class="o">.</span><span class="nf">dispatch</span><span class="p">(</span><span class="kt">AddAction</span><span class="p">())</span>
</code></pre>
<h1 id='components' class='heading'>Components</h1>

<p>This section will show details about the various core components you&rsquo;ve been shown in the previous section. </p>
<h2 id='state' class='heading'>State</h2>

<p>The application state is defined in a single data structure, which should be a <code>struct</code>. This struct can have other structs as members, which allows you to add different sub-states as your app grows. The state struct should store your entire application state. This includes the UI state, navigation state and the state of your model layer.</p>

<p>Here&rsquo;s an example of a state struct as defined in the <a href="https://github.com/ReSwift/CounterExample-Navigation-TimeTravel">Counter Example</a>:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">AppState</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">counter</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">var</span> <span class="nv">navigationState</span> <span class="o">=</span> <span class="kt">NavigationState</span><span class="p">()</span>
<span class="p">}</span>
</code></pre>

<p>If you are including <code>ReSwiftRouter</code> in your project, your app state needs to contain a property of type <code>NavigationState</code>. This is the sub-state the router will use to store the current route.</p>
<h3 id='derived-state' class='heading'>Derived State</h3>

<p>Note that you don&rsquo;t need to store derived state inside of your app state. The app state should store all the information that uniquely identifies the current state and allows it to be reconstructed, but none that can be easily derived. For example, instead of directly storing a <code>UIImage</code> you should store a URL that can be used to fetch the image from a cache or a download.</p>
<h2 id='actions' class='heading'>Actions</h2>

<p>Actions are used to express intended state changes. Actions don&rsquo;t contain functions. Instead, they provide information about the intended state change. For example, the user to be deleted in a <code>DeleteUser</code> action. In your ReSwift app you will define actions for every possible state change that can happen. Reducers handle these actions and implement state changes based on the information the actions provide. All actions in ReSwift conform to the <code><a href="Actions.html#/s:7ReSwift6ActionP">Action</a></code> protocol, which currently is just a marker protocol.</p>

<p>To provide your own action, simply create a type that conforms to the <code><a href="Actions.html#/s:7ReSwift6ActionP">Action</a></code> protocol:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">SetOAuthURL</span><span class="p">:</span> <span class="kt">Action</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">oAuthUrl</span><span class="p">:</span> <span class="kt">URL</span>
<span class="p">}</span>
</code></pre>
<h2 id='reducers' class='heading'>Reducers</h2>

<p>Reducers are the <strong>only place</strong> in which you should <strong>modify</strong> application state. Reducers take the current application state and an action then return the new transformed application state. We recommend to provide many small reducers that each handle a subset of your application state.</p>

<p>You can do this by implementing a top-level function that matches the <code><a href="Reducers.html#/s:7ReSwift7Reducera">Reducer</a></code> signature. This reducer will then call individual reducer functions for each different part of the app state, according to their areas of responsibility.</p>

<p>Here&rsquo;s an example in which we construct a new state by calling sub-reducers with different sub-states:</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">appReducer</span><span class="p">(</span><span class="nv">action</span><span class="p">:</span> <span class="kt">Action</span><span class="p">,</span> <span class="nv">state</span><span class="p">:</span> <span class="kt">State</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">State</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kt">State</span><span class="p">(</span>
      <span class="nv">navigationState</span><span class="p">:</span> <span class="nf">navigationReducer</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">state</span><span class="p">?</span><span class="o">.</span><span class="n">navigationState</span><span class="p">),</span>
      <span class="nv">authenticationState</span><span class="p">:</span> <span class="nf">authenticationReducer</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">state</span><span class="p">?</span><span class="o">.</span><span class="n">authenticationState</span><span class="p">),</span>
      <span class="nv">repositories</span><span class="p">:</span> <span class="nf">repositoriesReducer</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">state</span><span class="p">?</span><span class="o">.</span><span class="n">repositories</span><span class="p">),</span>
      <span class="nv">bookmarks</span><span class="p">:</span> <span class="nf">bookmarksReducer</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">state</span><span class="p">?</span><span class="o">.</span><span class="n">bookmarks</span><span class="p">)</span>
   <span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>The <code><a href="Reducers.html#/s:7ReSwift7Reducera">Reducer</a></code> typealias is a function that takes an <code><a href="Actions.html#/s:7ReSwift6ActionP">Action</a></code> and a <code>State?</code> then returns a <code>State</code>. Typically reducers will be responsible for initializing the application state. When they receive <code>nil</code> as the current state, they should return the initial default value for their portion of the state. In the example above the <code>appReducer</code> delegates all calls to other reducer functions. </p>

<p>For example, <code>authenticationReducer</code> is responsible for providing the <code>authenticationState</code>. Here&rsquo;s what the <code>authenticationReducer</code> function might look like:</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">authenticationReducer</span><span class="p">(</span><span class="nv">action</span><span class="p">:</span> <span class="kt">Action</span><span class="p">,</span> <span class="nv">state</span><span class="p">:</span> <span class="kt">AuthenticationState</span><span class="p">?)</span> <span class="o">-&gt;</span> <span class="kt">AuthenticationState</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">state</span> <span class="o">=</span> <span class="n">state</span> <span class="p">??</span> <span class="nf">initialAuthenticationState</span><span class="p">()</span>

    <span class="k">switch</span> <span class="n">action</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">_</span> <span class="k">as</span> <span class="kt">ReSwiftInit</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="k">case</span> <span class="k">let</span> <span class="nv">action</span> <span class="k">as</span> <span class="kt">SetOAuthURL</span><span class="p">:</span>
        <span class="n">state</span><span class="o">.</span><span class="n">oAuthURL</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">oAuthUrl</span>
    <span class="k">case</span> <span class="k">let</span> <span class="nv">action</span> <span class="k">as</span> <span class="kt">UpdateLoggedInState</span><span class="p">:</span>
        <span class="n">state</span><span class="o">.</span><span class="n">loggedInState</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">loggedInState</span>
    <span class="k">default</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">state</span>
<span class="p">}</span>
</code></pre>

<p>You can see that the <code>authenticationReducer</code> function is a free function. You can define it with any arbitrary signature but we recommend that it resembles the <code><a href="Reducers.html#/s:7ReSwift7Reducera">Reducer</a></code> typealias (action and current state in, new state out). </p>

<p><strong>Note:</strong> <em>The typealias uses unnamed parameters because Swift does not allow parameter names in this case so we say we recommend it &ldquo;resembles&rdquo; the signature defined in the typealias while our examples use named <code>action</code> and <code>state</code> parameters for clarity.</em></p>

<p>This sub-reducer first checks if the state provided is <code>nil</code>. If that&rsquo;s the case, it sets the state to the initial default state. Next, the reducer switches over the provided <code>action</code> and checks its type. Depending on the type of action, this reducer will update the state differently. This specific reducer is very simple: each action only triggers a single property of the state to update. Once the state update is complete, the reducer function returns the new state.</p>

<p>After the <code>appReducer</code> has called all of the sub-reducer functions, we have a new application state. <code>ReSwift.Store</code> will take care of publishing this new state to all subscribers.</p>
<h2 id='store-subscribers' class='heading'>Store Subscribers</h2>

<p>Store subscribers are types that are interested in receiving state updates from a store. Whenever the store updates its state it will notify all subscribers by calling the <code>newState</code> function on each. Subscribers need to conform to the <code><a href="Protocols/StoreSubscriber.html">StoreSubscriber</a></code> protocol:</p>
<pre class="highlight swift"><code><span class="kd">protocol</span> <span class="kt">StoreSubscriber</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">newState</span><span class="p">(</span><span class="nv">state</span><span class="p">:</span> <span class="kt">StoreSubscriberStateType</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>Most of your <code><a href="Protocols/StoreSubscriber.html">StoreSubscriber</a></code>s will be view controllers (<code>UIViewController</code> and <code>NSViewController</code>) and update their views&rsquo; representations of that state whenever they receive a new one via <code>newState()</code>.</p>
<h3 id='example-with-filtered-subscriptions' class='heading'>Example With Filtered Subscriptions</h3>

<p>Ideally most of our subscribers should only be interested in a very small portion of the overall app state. <code>ReSwift</code> provides a way to subselect the relevant state for a particular subscriber at the point of subscription. </p>

<p>Here&rsquo;s an example of a <code>UIViewController</code> subscribing, filtering, and unsubscribing to state changes:</p>
<pre class="highlight swift"><code><span class="k">override</span> <span class="kd">func</span> <span class="nf">viewWillAppear</span><span class="p">(</span><span class="nv">animated</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">super</span><span class="o">.</span><span class="nf">viewWillAppear</span><span class="p">(</span><span class="n">animated</span><span class="p">)</span>

    <span class="c1">// subscribe when VC appears</span>
    <span class="c1">// we are only interested in repository sub-state, filter it out of the overall state</span>
    <span class="n">store</span><span class="o">.</span><span class="nf">subscribe</span><span class="p">(</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span> <span class="n">subscription</span> <span class="k">in</span>
        <span class="n">subscription</span><span class="o">.</span><span class="n">select</span> <span class="p">{</span> <span class="n">state</span> <span class="k">in</span> <span class="n">state</span><span class="o">.</span><span class="n">repositories</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">override</span> <span class="kd">func</span> <span class="nf">viewWillDisappear</span><span class="p">(</span><span class="nv">animated</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">super</span><span class="o">.</span><span class="nf">viewWillDisappear</span><span class="p">(</span><span class="n">animated</span><span class="p">)</span>
    <span class="c1">// unsubscribe when VC disappears</span>
    <span class="n">store</span><span class="o">.</span><span class="nf">unsubscribe</span><span class="p">(</span><span class="k">self</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// The `state` argument needs to match the selected sub-state</span>
<span class="kd">func</span> <span class="nf">newState</span><span class="p">(</span><span class="nv">state</span><span class="p">:</span> <span class="kt">Response</span><span class="o">&lt;</span><span class="p">[</span><span class="kt">Repository</span><span class="p">]</span><span class="o">&gt;</span><span class="p">?)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="kt">Success</span><span class="p">(</span><span class="n">repositories</span><span class="p">)</span> <span class="o">=</span> <span class="n">state</span> <span class="p">{</span>
        <span class="n">dataSource</span><span class="p">?</span><span class="o">.</span><span class="n">array</span> <span class="o">=</span> <span class="n">repositories</span>
        <span class="n">tableView</span><span class="o">.</span><span class="nf">reloadData</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>In the example above we only select a single property from the overall application state: a network <code>Response</code> with a list of repositories.</p>

<p>When selecting a sub-state as part of calling the <code>subscribe</code> function, you need to make sure that the argument of the <code>newState</code> function has the same type as that which is returned by the state subselection in the <code>subscribe</code> function.</p>

<p>When subscribing within a simpler view controller you will typically update the view from within the <code>newState</code> function. You can of course parcel out responsibility for more complex view updating logic to other functions that <code>newState</code> will call. For example, the logic of creating the derived state such as an attributed string should live in its own function whose arguments include the necessary information given by <code>newState</code>.</p>
<h2 id='example-of-skipping-identical-state-updates' class='heading'>Example of Skipping Identical State Updates</h2>

<p>By default, when you create a <code><a href="Classes/Store.html">Store</a></code> it will be set up to use the <code>skipRepeats</code> subscription transformation for the selected sub-state if it conforms to <code>Equatable</code>. You can disable this by setting <code>automaticallySkipsRepeats</code> to <code>false</code> in the identifier. With this change, every dispatched action will trigger an update to all subscribers even if their sub-state has not changed its value.</p>

<p>You can selectively enable skipping duplicate values with <code>skip(when:)</code>:</p>
<pre class="highlight swift"><code><span class="k">override</span> <span class="kd">func</span> <span class="nf">viewWillAppear</span><span class="p">(</span><span class="nv">animated</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">super</span><span class="o">.</span><span class="nf">viewWillAppear</span><span class="p">(</span><span class="n">animated</span><span class="p">)</span>

    <span class="n">store</span><span class="o">.</span><span class="nf">subscribe</span><span class="p">(</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span> <span class="n">subcription</span> <span class="k">in</span>
        <span class="n">subcription</span><span class="o">.</span><span class="nf">skip</span><span class="p">(</span><span class="nv">when</span><span class="p">:</span> <span class="o">==</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>If your state does not conform to <code>Equatable</code>, simply passing <code>==</code> as the predicate won&rsquo;t work unless you write the equality function. You can also pass a closure to do the work, giving you more control over what should be considered a change for each of your subscribers. A more complex example:</p>
<pre class="highlight swift"><code><span class="n">store</span><span class="o">.</span><span class="nf">subscribe</span><span class="p">(</span><span class="k">self</span><span class="p">)</span> <span class="p">{</span> <span class="n">subcription</span> <span class="k">in</span>
    <span class="n">subcription</span>
        <span class="c1">// We're only interested in repositories ...</span>
        <span class="o">.</span><span class="n">select</span>  <span class="p">{</span> <span class="n">state</span> <span class="k">in</span> <span class="n">state</span><span class="o">.</span><span class="n">repositories</span> <span class="p">}</span>
        <span class="c1">// ... but want to always refresh the view when the state has content,</span>
        <span class="c1">// for example because checking contents for equality would be </span>
        <span class="c1">// too expensive. In other words, skip if empty.</span>
        <span class="o">.</span><span class="nf">skip</span><span class="p">(</span><span class="nv">when</span><span class="p">:</span> <span class="p">{</span> <span class="n">repositories</span> <span class="k">in</span> <span class="n">repositories</span><span class="o">.</span><span class="n">isEmpty</span> <span class="p">})</span>
<span class="p">}</span>
</code></pre>
<h2 id='beyond-the-basics' class='heading'>Beyond the Basics</h2>
<h3 id='asynchronous-operations' class='heading'>Asynchronous Operations</h3>

<p>Conceptually asynchronous operations can simply be treated as state updates that occur at a later point in time. Here&rsquo;s a simple example of how to tie an asynchronous network request to a <code>ReSwift</code> state update:</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">fetchGitHubRepositories</span><span class="p">(</span><span class="nv">state</span><span class="p">:</span> <span class="kt">State</span><span class="p">,</span> <span class="nv">store</span><span class="p">:</span> <span class="kt">Store</span><span class="o">&lt;</span><span class="kt">State</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Action</span><span class="p">?</span> <span class="p">{</span>
    <span class="k">guard</span> <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="kt">LoggedIn</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">authenticationState</span><span class="o">.</span><span class="n">loggedInState</span>  <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">nil</span> <span class="p">}</span>

    <span class="kt">Octokit</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span><span class="o">.</span><span class="n">repositories</span> <span class="p">{</span> <span class="n">response</span> <span class="k">in</span>
        <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">async</span> <span class="p">{</span>
            <span class="n">store</span><span class="o">.</span><span class="nf">dispatch</span><span class="p">(</span><span class="kt">SetRepostories</span><span class="p">(</span><span class="nv">repositories</span><span class="p">:</span> <span class="n">response</span><span class="p">))</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="kc">nil</span>
<span class="p">}</span>
</code></pre>

<p>In this example we&rsquo;re using the <code>Octokit</code> library to perform a network request that fetches a user&rsquo;s repositories. Within the callback block of the function we dispatch a state update that injects the received repositories into the app state. This will trigger all subscribers to be informed about the new state.</p>

<p>Note that the callback block from the network request arrives on a background thread, therefore we&rsquo;re using <code>DispatchQueue.main.async</code> to perform the state update on the main thread. <code>ReSwift</code> will call reducers and subscribers on whatever thread you have dispatched an action from. We recommend to always dispatch from the main thread, but <code>ReSwift</code> does not enforce this recommendation. ReSwift <em>will</em> enforce that all Dispatches, Store Subscribes and Store Unsubscribes are on the same thread or serial Grand Central Dispatch queue. Therefore the main dispatch queue works, however the global dispatch queue, being concurrent, will fail.</p>

<p>In many cases your asynchronous tasks will consist of two separate steps:</p>

<ol>
<li>Update UI to show a loading indicator</li>
<li>Refresh the UI once data arrived (or an error occurred)</li>
</ol>

<p>You can extend the example above by dispatching a separate action as soon as the network request starts. The goal of that action is to trigger the UI to show a loading indicator as a side-effect of the fetch request.</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">fetchGitHubRepositories</span><span class="p">(</span><span class="nv">state</span><span class="p">:</span> <span class="kt">State</span><span class="p">,</span> <span class="nv">store</span><span class="p">:</span> <span class="kt">Store</span><span class="o">&lt;</span><span class="kt">State</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Action</span><span class="p">?</span> <span class="p">{</span>
    <span class="k">guard</span> <span class="k">case</span> <span class="kd">let</span> <span class="o">.</span><span class="kt">LoggedIn</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">authenticationState</span><span class="o">.</span><span class="n">loggedInState</span>  <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">nil</span> <span class="p">}</span>

    <span class="kt">Octokit</span><span class="p">(</span><span class="n">configuration</span><span class="p">)</span><span class="o">.</span><span class="n">repositories</span> <span class="p">{</span> <span class="n">response</span> <span class="k">in</span>
        <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">async</span> <span class="p">{</span>
            <span class="n">store</span><span class="o">.</span><span class="nf">dispatch</span><span class="p">(</span><span class="kt">SetRepostories</span><span class="p">(</span><span class="nv">repositories</span><span class="p">:</span> <span class="o">.</span><span class="nf">repositories</span><span class="p">(</span><span class="n">response</span><span class="p">)))</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="kt">SetRepositories</span><span class="p">(</span><span class="nv">repositories</span><span class="p">:</span> <span class="o">.</span><span class="n">loading</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>In the example above we&rsquo;re using an <code>enum</code> to represent the different states of a single state slice that depends on a network request. It may look something like this:</p>
<pre class="highlight swift"><code><span class="kd">enum</span> <span class="kt">GitHubFetchRequestState</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">loading</span>
    <span class="k">case</span> <span class="nf">repositories</span><span class="p">(</span><span class="kt">Response</span><span class="o">&lt;</span><span class="p">[</span><span class="kt">Repository</span><span class="p">]</span><span class="o">&gt;</span><span class="p">)</span> <span class="c1">// the OctoKit response provided to the `repositories` closure</span>
    <span class="k">case</span> <span class="nf">networkError</span><span class="p">(</span><span class="kt">Error</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p>There are many different ways to model states of a network request but it will mostly involve using multiple dispatched actions at different stages of your network requests.</p>
<h3 id='action-creators' class='heading'>Action Creators</h3>

<p>An important aspect of adopting <code>ReSwift</code> is an improved separation of concerns. Specifically, your view controllers should mostly be concerned with adapting its representation to reflect a new app state and for triggering <code><a href="Actions.html#/s:7ReSwift6ActionP">Action</a></code>s upon user interactions.</p>

<p>The triggering of actions should always be as simple as possible to avoid any sort of complicated business logic in the view controller. However, in some cases it can be complicated to decide whether an action should be dispatched or not. Instead of checking the necessary state directly in the view controller, you can use <code>ActionCreator</code>s to perform a conditional dispatch.</p>

<p>Just like an <code><a href="Actions.html#/s:7ReSwift6ActionP">Action</a></code>, an <code>ActionCreator</code> function can be dispatched to the store. An <code>ActionCreator</code> takes the current application state and a reference to a store then <em>may</em> return an <code><a href="Actions.html#/s:7ReSwift6ActionP">Action</a></code> (hence the <code>Action?</code> optional return type).</p>

<p>An <code>ActionCreator</code> has the following type signature:</p>
<pre class="highlight swift"><code><span class="kd">typealias</span> <span class="kt">ActionCreator</span> <span class="o">=</span> <span class="p">(</span><span class="nv">state</span><span class="p">:</span> <span class="kt">State</span><span class="p">,</span> <span class="nv">store</span><span class="p">:</span> <span class="kt">StoreType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Action</span><span class="p">?</span>
</code></pre>

<p>A very simple example of an <code>ActionCreator</code> might be:</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">doubleValueIfSmall</span><span class="p">(</span><span class="nv">state</span><span class="p">:</span> <span class="kt">TestAppState</span><span class="p">,</span> <span class="nv">store</span><span class="p">:</span> <span class="kt">Store</span><span class="o">&lt;</span><span class="kt">TestAppState</span><span class="o">&gt;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Action</span><span class="p">?</span> <span class="p">{</span>
    <span class="k">if</span> <span class="n">state</span><span class="o">.</span><span class="n">testValue</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kt">SetValueAction</span><span class="p">(</span><span class="n">state</span><span class="o">.</span><span class="n">testValue</span><span class="o">!</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">nil</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h3 id='middleware' class='heading'>Middleware</h3>

<p>ReSwift supports middleware in the same way as Redux does. You can read this great documentation on <a href="http://redux.js.org/docs/advanced/Middleware.html">Redux middleware</a>  to get started. Middleware allows developers to provide extensions that wrap the <code>dispatch</code> function.</p>

<p>Let&rsquo;s take a look at a quick example that shows how <code>ReSwift</code> supports Redux-style middleware. This example middleware prints all actions to the console:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">loggingMiddleware</span><span class="p">:</span> <span class="kt">Middleware</span><span class="o">&lt;</span><span class="kt">Any</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">{</span> <span class="n">dispatch</span><span class="p">,</span> <span class="n">getState</span> <span class="k">in</span>
    <span class="k">return</span> <span class="p">{</span> <span class="n">next</span> <span class="k">in</span>
        <span class="k">return</span> <span class="p">{</span> <span class="n">action</span> <span class="k">in</span>
            <span class="c1">// perform middleware logic</span>
            <span class="nf">print</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

            <span class="c1">// call next middleware</span>
            <span class="k">return</span> <span class="nf">next</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>The generic <code>Any</code> in middleware refers to the return type in <code>getState</code>, and needs to be compatible with the <code>State</code> associated type in your <code><a href="Classes/Store.html">Store</a></code>.</p>

<p>You specify the middleware you would like to use when creating your store:</p>
<pre class="highlight swift"><code><span class="kt">Store</span><span class="p">(</span><span class="nv">reducer</span><span class="p">:</span> <span class="n">reducer</span><span class="p">,</span> <span class="nv">appState</span><span class="p">:</span> <span class="kt">TestStringAppState</span><span class="p">(),</span>
                    <span class="nv">middleware</span><span class="p">:</span> <span class="p">[</span><span class="n">loggingMiddleware</span><span class="p">,</span> <span class="n">secondMiddleware</span><span class="p">])</span>
</code></pre>

<p>The actions will pass through the middleware in the order in which they are arranged in the array passed to the store initializer. However, ideally middleware should not make any assumptions about when exactly it is called.</p>

          </div>
        </section>


      </article>
    </div>
    <section class='footer'>
      <p>© 2018 <a class="link" href="https://github.com/ReSwift/ReSwift" target="_blank" rel="external">ReSwift</a>. All rights reserved.</p>
      <p>Generated by <a class='link' href='https://github.com/realm/jazzy' target='_blank' rel='external'>jazzy ♪♫ v0.14.4</a>, a <a class='link' href='http://realm.io' target='_blank' rel='external'>Realm</a> project.</p>
    </section>
  </body>
</div>
</html>
